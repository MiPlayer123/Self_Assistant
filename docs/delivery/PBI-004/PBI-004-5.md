# PBI-004-5: App Flow Integration

## Description
Update main App component routing logic to handle offline scenarios based on subscription status, integrating all the offline access components and providing the complete user experience.

## Status History
- **2025-01-03 18:40** - create_task - Proposed - Created task for app flow integration - AI_Agent
- **2025-01-03 18:40** - user_approves - Proposed -> Agreed - Task approved for implementation - User
- **2025-01-03 18:40** - start_work - Agreed -> InProgress - Starting app flow integration - AI_Agent
- **2025-01-03 18:45** - submit_for_review - InProgress -> Review - Completed app flow integration with offline routing logic - AI_Agent
- **2025-01-03 20:15** - fix_routing - Review -> Review - Fixed routing logic so Pro/Enterprise users bypass connection screen when offline - AI_Agent
- **2025-01-03 20:25** - enhance_offline_ui - Review -> Review - Added offline indicators to user profile, cached subscription display, and disabled online-only actions when offline - AI_Agent
- **2025-01-03 20:35** - fix_pro_features - Review -> Review - Updated useUsageTracking to provide unlimited access for Pro/Enterprise users when offline, enabling full feature access - AI_Agent
- **2025-01-03 20:45** - add_offline_refresh - Review -> Review - Added "Refresh Cache" button for offline mode to manually update cached subscription data and restrictions - AI_Agent

## Requirements
- Integrate useOfflineMode hook into main App routing
- Handle offline scenarios before authentication checks
- Route subscribed users to WagooChatApp when offline
- Show enhanced ConnectionErrorScreen for appropriate cases
- Display OfflineNotification for subscribed users
- Default to local model when offline
- Preserve existing online functionality

## Implementation Plan
1. Update `src/App.tsx`:
   - Import useOfflineMode and OfflineNotification
   - Add offline routing logic before auth checks
   - Handle different offline scenarios (free, subscribed, expired)
   - Pass onContinueOffline handler to ConnectionErrorScreen
   - Integrate offline notifications
2. Ensure smooth transitions between online/offline modes
3. Test all user flow scenarios

## Test Plan
**Objectives**: Verify complete offline access functionality
**Scope**: End-to-end testing of all offline scenarios
**Environment**: Local development with network simulation
**Key Scenarios**:
- Free user offline → upgrade screen
- Subscribed user offline → notification + app access
- Online → offline → online transitions
- Expired subscription handling
**Success Criteria**: All user types have appropriate offline experiences

## Verification
- [x] Offline routing logic works before auth checks
- [x] Free users see upgrade messaging
- [x] Subscribed users access app offline with notification
- [x] Online/offline transitions smooth
- [x] Local model defaults when offline
- [x] Existing online functionality preserved

## Files Modified
- `src/App.tsx` (updated) 