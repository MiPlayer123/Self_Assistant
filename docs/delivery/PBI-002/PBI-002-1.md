# PBI-002-1: Floating Glass Button Implementation

**Parent Task List**: [Tasks for PBI-002](./tasks.md)

## Description

Implement a floating glass button with Apple's liquid glass UI styling that provides persistent access to chat functionality. The button should always be visible in the bottom-right corner (unless specifically hidden), allowing users to toggle the chat window visibility and providing enhanced window state management with smooth animations.

## Status History

- **2024-12-19 22:55** - create_task - Proposed -> Proposed - Task created for floating glass button implementation - User
- **2024-12-19 23:00** - user_approves - Proposed -> Agreed - Task approved for implementation - User
- **2024-12-19 23:01** - start_work - Agreed -> InProgress - Implementation started - AI_Agent
- **2024-12-19 23:15** - submit_for_review - InProgress -> Review - Core implementation completed, ready for review - AI_Agent
- **2024-12-19 23:20** - user_feedback - Review -> InProgress - User requested independent chat/button toggle behavior - User  
- **2024-12-19 23:25** - submit_for_review - InProgress -> Review - Updated logic: chat toggle independent from button, refined keyboard shortcuts - AI_Agent
- **2024-12-19 23:35** - user_feedback - Review -> InProgress - User requested button repositioning to avoid overlap with chat window and fix invisible barriers - User
- **2024-12-19 23:40** - submit_for_review - InProgress -> Review - Fixed button positioning: moved to separate corner (bottom-3 right-3), properly sized container, eliminated invisible barriers - AI_Agent

## Requirements

### Floating Glass Button Component
- Create React component with liquid glass aesthetic using CSS backdrop filters
- Position fixed in separate corner (further bottom-right than chat window) to avoid overlap
- Use properly sized container (68px x 68px) with pointer-events-none to eliminate invisible barriers
- Implement the provided CSS styling with SVG filters for displacement mapping
- Add smooth hover animations and scaling effects
- Ensure button remains visible across window resizes and moves

### Window State Management
- Extend current binary show/hide to support three states:
  - **Full Window**: Normal chat window fully visible
  - **Button Only**: Chat window hidden, floating button visible
  - **Completely Hidden**: Both window and button hidden
- Integrate with existing Electron window management
- Maintain state persistence across application restarts

### Enhanced Keyboard Shortcuts
- Modify existing Ctrl+B (Alt+B on Windows/Linux) behavior:
  - If window visible: Hide window, show button only
  - If button only: Show full window
  - If completely hidden: Show button only
- Add new Ctrl+Shift+B (Alt+Shift+B) shortcut:
  - Toggle button visibility (show/hide completely)
- Ensure platform-specific modifier keys work correctly
- Update keyboard shortcuts documentation

### Visual Integration
- Apply liquid glass styling matching provided CSS code
- Integrate with existing Wagoo dark theme
- Ensure proper contrast and accessibility
- Add smooth transitions between states
- Optimize performance across platforms

## Implementation Plan

1. **Create Glass Button Component**
   - Analyze provided CSS styling and convert to React component
   - Implement SVG filters for frosted glass effect
   - Add hover animations and interactions
   - Ensure proper positioning and responsiveness

2. **Extend Window State Management**
   - Update existing window visibility logic to support three states
   - Modify Electron main process window controls
   - Add state persistence using existing storage mechanisms
   - Integrate with current window positioning system

3. **Update Keyboard Shortcuts**
   - Extend existing shortcuts.ts to handle new Ctrl+Shift+B command
   - Modify Ctrl+B behavior to work with new state system
   - Ensure cross-platform compatibility
   - Test all shortcut combinations

4. **Integration and Testing**
   - Integrate button with existing chat interface
   - Test state transitions and animations
   - Verify keyboard shortcuts work correctly
   - Ensure no regressions in existing functionality

5. **Documentation Updates**
   - Update KEYBOARD_SHORTCUTS.md with new commands
   - Document new window states and behavior
   - Add any necessary technical documentation

## Test Plan

### Unit Testing
- TypeScript compilation successful
- React component renders without errors
- CSS animations and effects work properly
- No console errors or warnings

### Integration Testing
- Button appears in correct position on all platforms
- Window state transitions work smoothly
- Keyboard shortcuts function correctly across platforms
- Existing shortcuts continue to work without regression
- State persistence works across application restarts

### Visual Testing
- Glass morphism effects render correctly
- Hover animations are smooth and responsive
- Button maintains visibility across window operations
- No visual artifacts or rendering issues
- Consistent with existing Wagoo aesthetic

### User Experience Testing
- Intuitive interaction patterns
- Smooth transitions between states
- Appropriate feedback for all actions
- Performance remains optimal

## Verification

- [x] Floating glass button component created with liquid glass styling
- [x] Button positioned correctly in separate dedicated window
- [x] Separate button window with 68x68 pixel dimensions
- [x] SVG filters and backdrop effects implemented
- [x] Hover animations work smoothly
- [x] Independent window management: main chat window and button window
- [x] Ctrl+B (Alt+B) toggles main chat window visibility
- [x] Ctrl+Shift+B (Alt+Shift+B) toggles button window visibility
- [x] Platform-specific keyboard modifiers work correctly
- [x] Screen capture resistance applied to button window
- [x] No window overlap - main window positioned to avoid button space
- [x] Transparent window background for proper glass effect visibility
- [x] No window controls (X buttons) on button window
- [x] Button window always on top with higher z-index than main window
- [x] Integration with existing window positioning
- [x] No regressions in existing functionality
- [x] Performance optimized across platforms
- [x] Documentation updated with new shortcuts and behavior
- [x] All visual effects render correctly
- [x] macOS-specific settings: hidden from Mission Control, window switcher, etc.

## Files Modified

- **New Files:**
  - `src/components/ui/ButtonWindow.tsx` - Dedicated React component for separate button window with Apple's liquid glass UI styling
  - `src/components/ui/FloatingGlassButton.tsx` - Original floating button component (replaced by separate window approach)
  - `src/contexts/WindowStateContext.tsx` - Context for managing window states (replaced by separate window approach)

- **Modified Files:**
  - `src/App.tsx` - Added button window detection and routing logic
  - `src/_pages/SubscribedApp.tsx` - Removed floating button integration, simplified to main content only
  - `electron/main.ts` - Added complete button window management with screen capture resistance
  - `electron/shortcuts.ts` - Updated shortcuts to control separate button and main windows independently
  - `electron/preload.ts` - Added keyboard event listeners for new shortcuts (initial implementation)
  - `electron/ipcHandlers.ts` - Added new IPC handlers for window state management (initial implementation)
  - `src/env.d.ts` - Updated ElectronAPI interface with new methods (initial implementation)
  - `src/types/electron.d.ts` - Updated ElectronAPI interface with new methods (initial implementation)
  - `KEYBOARD_SHORTCUTS.md` - Added documentation for new Ctrl+Shift+B shortcut 